{"ast":null,"code":"var _jsxFileName = \"/Users/krmpi/PycharmProjects/FER/moonstone-CCS/client/src/components/Gantt/Gantt.js\";\nimport React, { Component } from 'react';\nimport { gantt } from 'dhtmlx-gantt';\nimport 'dhtmlx-gantt/codebase/dhtmlxgantt.css';\nimport $ from \"jquery\";\nimport jsonTimestamp from '../../static/config.json';\nimport jsonAction from '../../static/action.json';\nimport jsonStateLevelScenario from '../../static/state_level_scenario.json';\nimport GanttTask from '../GanttTask';\nexport default class Gantt extends Component {\n  constructor(props) {\n    super(props);\n    gantt.config.xml_date = \"%Y-%m-%d %H:%i\";\n    const {\n      tasks\n    } = this.props;\n    gantt.init(this.ganttContainer);\n    gantt.parse(tasks);\n    this.configSetup();\n    var actionLabel = this.loadActions();\n    var priorityList = this.loadPriorities();\n    var playersLabel = this.loadPlayers();\n    this.state = {\n      priority: priorityList,\n      actionLabel: actionLabel,\n      playersLabel: playersLabel\n    };\n  }\n\n  setZoom(value) {\n    switch (value) {\n      case 'Hours':\n        gantt.config.scale_unit = 'day';\n        gantt.config.date_scale = '%d %M';\n        gantt.config.scale_height = 60;\n        gantt.config.min_column_width = 30;\n        gantt.config.subscales = [{\n          unit: 'hour',\n          step: 1,\n          date: '%H'\n        }];\n        break;\n\n      case 'Days':\n        gantt.config.min_column_width = 70;\n        gantt.config.scale_unit = 'week';\n        gantt.config.date_scale = '#%W';\n        gantt.config.subscales = [{\n          unit: 'day',\n          step: 1,\n          date: '%d %M'\n        }];\n        gantt.config.scale_height = 60;\n        break;\n\n      case 'Months':\n        gantt.config.min_column_width = 70;\n        gantt.config.scale_unit = 'month';\n        gantt.config.date_scale = '%F';\n        gantt.config.scale_height = 60;\n        gantt.config.subscales = [{\n          unit: 'week',\n          step: 1,\n          date: '#%W'\n        }];\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  shouldComponentUpdate(nextProps) {\n    return this.props.zoom !== nextProps.zoom;\n  }\n\n  componentDidUpdate() {\n    gantt.render();\n  }\n\n  loadActions() {\n    var actionLabel = [];\n    var keys = Object.keys(jsonAction.actions);\n    $.each(keys, function (i, val) {\n      actionLabel.push({\n        \"key\": i,\n        \"label\": val\n      });\n    });\n    return actionLabel;\n  }\n\n  loadPriorities() {\n    var priorityList = [];\n    var priorities = \"\";\n    $.each(jsonTimestamp.priority, function (i, val) {\n      priorityList.push({\n        \"key\": i,\n        \"label\": val\n      });\n      priorities += \";{ key:\" + i + \", label:\" + val + \"}\";\n    });\n\n    for (let r in priorityList) {\n      $('#priority').append($('<option>', {\n        value: r,\n        text: priorityList[r]\n      }));\n    } //        var prr = \"\";\n    //        for (let pr in priorityList){\n    //            if (priorityList.indexOf(pr) !== 0){\n    //                prr.append(\",\");\n    //            }\n    //            prr.append(pr);\n    //        }\n    //var priorities = String.join(\",\", priorityList);\n\n\n    var prr = priorities.split(\";\");\n    console.log(prr);\n    console.log(\"before append: \" + priorities.split(\",\"));\n    gantt.locale.labels[\"PriorityList\"] = priorities;\n    return priorityList;\n  }\n\n  loadPlayers() {\n    var playersLabel = [];\n    var cpt = 0;\n    $.each(jsonStateLevelScenario.players, function (i, val) {\n      $.each(val.actors, function (y, val2) {\n        playersLabel.push({\n          \"key\": cpt,\n          \"label\": i + \".\" + val2.name\n        });\n        cpt++;\n      });\n    });\n\n    for (let r in playersLabel) {\n      $('#holder').append($('<option>', {\n        value: r,\n        text: playersLabel[r][\"label\"]\n      }));\n    }\n\n    return playersLabel;\n  }\n\n  setColumns() {\n    console.log(\"gant locale: \" + gantt.locale.labels[\"PriorityList\"]);\n    gantt.config.columns = [{\n      name: \"text\",\n      label: \"Task name\",\n      tree: true,\n      width: 150\n    }, {\n      name: \"start_date\",\n      label: \"Start time\",\n      align: \"center\",\n      resize: true,\n      width: 120\n    }, {\n      name: \"end_date\",\n      label: \"End date\",\n      align: \"center\",\n      resize: true,\n      width: 120\n    }, {\n      name: \"priority\",\n      label: \"Priority\",\n      height: 22,\n      type: \"select\",\n      map_to: \"priority\",\n      template: function (obj) {\n        var priorities = gantt.locale.labels[\"PriorityList\"].split(';');\n        var token = \"key:\" + obj.priority + \",\";\n        var correctPriority = priorities.find(element => element.includes(token));\n        var myRegexp = /(?:^|\\s)label:(.*?)}(?:\\s|$)/g;\n        var match = myRegexp.exec(correctPriority);\n\n        if (match !== null && match[1] !== null) {\n          return match[1];\n        }\n\n        return \"Low\";\n      }\n    }, {\n      name: \"add\",\n      label: \"\",\n      width: 44\n    }];\n  }\n\n  configSetup() {\n    gantt.config.wide_form = 1;\n    gantt.config.work_time = true;\n    gantt.config.order_branch = true;\n    gantt.config.autoscroll = true;\n    gantt.config.auto_scheduling = true;\n    gantt.config.autoscroll_speed = 100;\n    gantt.config.fit_tasks = true;\n    gantt.config.scale_unit = this.props.zoom.scale_unit;\n    gantt.config.duration_unit = \"hour\";\n    gantt.config.scale_height = 50;\n    gantt.config.min_column_width = 1000;\n    gantt.config.date_scale = this.props.zoom.date_scale;\n    gantt.config.open_tree_initially = true;\n    gantt.config.subscales = this.props.zoom.subscales;\n\n    gantt.templates.timeline_cell_class = function (task, date) {\n      if (!gantt.isWorkTime({\n        task: task,\n        date: date\n      })) return \"week_end\";\n      return \"\";\n    };\n\n    gantt.setWorkTime({\n      hours: [9, 17]\n    });\n    gantt.setWorkTime({\n      day: 6,\n      hours: false\n    });\n    gantt.setWorkTime({\n      day: 7,\n      hours: false\n    });\n    gantt.locale.labels[\"milestone\"] = \"Milestone\";\n    gantt.config.buttons_left = [\"dhx_save_btn\", \"dhx_cancel_btn\", \"milestone\"];\n    gantt.config.buttons_right = [\"dhx_delete_btn\"]; //addTodayMarker();\n  }\n\n  render() {\n    this.setColumns();\n    const {\n      zoom\n    } = this.props;\n    this.setZoom(zoom);\n    var task_sections = [{\n      name: \"description\",\n      height: 50,\n      map_to: \"text\",\n      type: \"textarea\",\n      focus: true\n    }, {\n      name: \"time\",\n      height: 72,\n      type: \"time\",\n      map_to: \"auto\"\n    }, {\n      name: \"holder\",\n      height: 50,\n      map_to: \"holder\",\n      type: \"select\",\n      options: this.state.playersLabel\n    }, {\n      name: \"action\",\n      height: 50,\n      map_to: \"action\",\n      type: \"select\",\n      options: this.state.actionLabel\n    }, {\n      name: \"priority\",\n      height: 50,\n      map_to: \"priority\",\n      type: \"select\",\n      options: this.state.priority\n    }];\n    gantt.locale.labels[\"section_holder\"] = \"Holder\";\n    gantt.locale.labels[\"section_action\"] = \"Action\";\n    gantt.locale.labels[\"section_priority\"] = \"Priority\";\n    gantt.config.lightbox.sections = task_sections;\n    gantt.refreshData();\n    gantt.render();\n    console.log(gantt._lightbox_template);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      ref: input => {\n        this.ganttContainer = input;\n      },\n      style: {\n        width: '100%',\n        height: '100%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 13\n      }\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/krmpi/PycharmProjects/FER/moonstone-CCS/client/src/components/Gantt/Gantt.js"],"names":["React","Component","gantt","$","jsonTimestamp","jsonAction","jsonStateLevelScenario","GanttTask","Gantt","constructor","props","config","xml_date","tasks","init","ganttContainer","parse","configSetup","actionLabel","loadActions","priorityList","loadPriorities","playersLabel","loadPlayers","state","priority","setZoom","value","scale_unit","date_scale","scale_height","min_column_width","subscales","unit","step","date","shouldComponentUpdate","nextProps","zoom","componentDidUpdate","render","keys","Object","actions","each","i","val","push","priorities","r","append","text","prr","split","console","log","locale","labels","cpt","players","actors","y","val2","name","setColumns","columns","label","tree","width","align","resize","height","type","map_to","template","obj","token","correctPriority","find","element","includes","myRegexp","match","exec","wide_form","work_time","order_branch","autoscroll","auto_scheduling","autoscroll_speed","fit_tasks","duration_unit","open_tree_initially","templates","timeline_cell_class","task","isWorkTime","setWorkTime","hours","day","buttons_left","buttons_right","task_sections","focus","options","lightbox","sections","refreshData","_lightbox_template","input"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { gantt } from 'dhtmlx-gantt';\nimport 'dhtmlx-gantt/codebase/dhtmlxgantt.css';\nimport $ from \"jquery\";\nimport jsonTimestamp from '../../static/config.json';\nimport jsonAction from '../../static/action.json';\nimport jsonStateLevelScenario from '../../static/state_level_scenario.json';\nimport GanttTask from '../GanttTask';\n\nexport default class Gantt extends Component {\n    constructor(props){\n        super(props);\n\n        gantt.config.xml_date = \"%Y-%m-%d %H:%i\";\n        const { tasks } = this.props;\n        gantt.init(this.ganttContainer);\n        gantt.parse(tasks);\n        this.configSetup();\n\n        var actionLabel = this.loadActions();\n        var priorityList = this.loadPriorities();\n        var playersLabel = this.loadPlayers();\n\n        this.state = {\n            priority: priorityList,\n            actionLabel: actionLabel,\n            playersLabel: playersLabel\n        }\n    }\n\n    setZoom(value) {\n        switch (value) {\n            case 'Hours':\n                gantt.config.scale_unit = 'day';\n                gantt.config.date_scale = '%d %M';\n\n                gantt.config.scale_height = 60;\n                gantt.config.min_column_width = 30;\n                gantt.config.subscales = [\n                    { unit:'hour', step:1, date:'%H' }\n                ];\n            break;\n            case 'Days':\n                gantt.config.min_column_width = 70;\n                gantt.config.scale_unit = 'week';\n                gantt.config.date_scale = '#%W';\n                gantt.config.subscales = [\n                    { unit: 'day', step: 1, date: '%d %M' }\n                ];\n                gantt.config.scale_height = 60;\n            break;\n            case 'Months':\n                gantt.config.min_column_width = 70;\n                gantt.config.scale_unit = 'month';\n                gantt.config.date_scale = '%F';\n                gantt.config.scale_height = 60;\n                gantt.config.subscales = [\n                    { unit:'week', step:1, date:'#%W' }\n                ];\n            break;\n            default:\n            break;\n        }\n    }\n\n    shouldComponentUpdate(nextProps) {\n        return this.props.zoom !== nextProps.zoom;\n    }\n\n    componentDidUpdate() {\n        gantt.render();\n    }\n\n    loadActions(){\n        var actionLabel = [];\n        var keys = Object.keys(jsonAction.actions);\n        $.each(keys, function(i, val) {\n            actionLabel.push({\"key\": i, \"label\": val})\n        });\n\n        return actionLabel;\n    }\n\n    loadPriorities(){\n        var priorityList = [];\n        var priorities = \"\";\n        $.each(jsonTimestamp.priority, function(i, val) {\n            priorityList.push({\"key\": i, \"label\": val})\n            priorities += \";{ key:\" + i + \", label:\" + val +\"}\";\n        });\n        for(let r in priorityList){$('#priority').append($('<option>',{value: r,text: priorityList[r]}))}\n\n//        var prr = \"\";\n//        for (let pr in priorityList){\n//            if (priorityList.indexOf(pr) !== 0){\n//                prr.append(\",\");\n//            }\n//            prr.append(pr);\n//        }\n\n\n\n        //var priorities = String.join(\",\", priorityList);\n        var prr = priorities.split(\";\");\n        console.log(prr);\n        console.log(\"before append: \" + priorities.split(\",\"));\n        gantt.locale.labels[\"PriorityList\"] = priorities;\n        return priorityList;\n    }\n\n    loadPlayers(){\n        var playersLabel = [];\n        var cpt = 0;\n        $.each(jsonStateLevelScenario.players, function(i, val) {\n            $.each(val.actors, function(y, val2) {\n                playersLabel.push({\"key\": cpt, \"label\": i + \".\" + val2.name})\n                cpt++;\n            })\n        });\n        for(let r in playersLabel){$('#holder').append($('<option>',{value: r,text: playersLabel[r][\"label\"]}))}\n\n        return playersLabel;\n    }\n\n    setColumns(){\n        console.log(\"gant locale: \" + gantt.locale.labels[\"PriorityList\"]);\n        gantt.config.columns = [\n        {name:\"text\",       label:\"Task name\",  tree:true, width: 150 },\n        {name:\"start_date\", label:\"Start time\", align:\"center\", resize: true, width: 120 },\n        {name:\"end_date\",   label:\"End date\",   align:\"center\", resize: true, width: 120 },\n        {name:\"priority\",  label:\"Priority\", height:22, type:\"select\", map_to:\"priority\", template:function(obj){\n            var priorities = gantt.locale.labels[\"PriorityList\"].split(';');\n            var token = \"key:\" + obj.priority + \",\";\n            var correctPriority = priorities.find(element => element.includes(token));\n            var myRegexp = /(?:^|\\s)label:(.*?)}(?:\\s|$)/g;\n            var match = myRegexp.exec(correctPriority);\n            if (match !== null && match[1] !== null){\n                return match[1];\n            }\n            return \"Low\";\n        }},\n        {name:\"add\",        label:\"\",           width:44 }\n        ];\n    }\n\n    configSetup() {\n      gantt.config.wide_form = 1;\n      gantt.config.work_time = true;\n      gantt.config.order_branch = true;\n      gantt.config.autoscroll = true;\n      gantt.config.auto_scheduling = true;\n      gantt.config.autoscroll_speed = 100;\n      gantt.config.fit_tasks = true;\n      gantt.config.scale_unit = this.props.zoom.scale_unit;\n      gantt.config.duration_unit = \"hour\";\n      gantt.config.scale_height = 50;\n      gantt.config.min_column_width = 1000;\n      gantt.config.date_scale = this.props.zoom.date_scale;\n      gantt.config.open_tree_initially = true;\n      gantt.config.subscales = this.props.zoom.subscales;\n      gantt.templates.timeline_cell_class = function(task, date){\n        if(!gantt.isWorkTime({task:task, date: date}))\n          return \"week_end\";\n        return \"\";\n      };\n      gantt.setWorkTime({\n        hours: [9,17]\n      })\n      gantt.setWorkTime({ day:6, hours:false });\n      gantt.setWorkTime({ day:7, hours:false });\n      gantt.locale.labels[\"milestone\"] = \"Milestone\";\n      gantt.config.buttons_left = [\"dhx_save_btn\", \"dhx_cancel_btn\", \"milestone\"];\n      gantt.config.buttons_right = [\"dhx_delete_btn\"];\n      //addTodayMarker();\n    }\n\n    render() {\n        this.setColumns();\n\n        const { zoom } = this.props;\n        this.setZoom(zoom);\n\n        var task_sections = [\n            { name: \"description\", height: 50, map_to: \"text\", type: \"textarea\", focus: true },\n            { name: \"time\", height: 72, type: \"time\", map_to: \"auto\" },\n            { name: \"holder\", height: 50, map_to:\"holder\", type:\"select\",options:this.state.playersLabel},\n            { name:\"action\", height: 50, map_to:\"action\", type:\"select\", options:this.state.actionLabel },\n            { name:\"priority\", height: 50, map_to:\"priority\", type:\"select\", options:this.state.priority }\n        ];\n\n        gantt.locale.labels[\"section_holder\"] = \"Holder\";\n        gantt.locale.labels[\"section_action\"] = \"Action\";\n        gantt.locale.labels[\"section_priority\"] = \"Priority\";\n\n        gantt.config.lightbox.sections = task_sections;\n        gantt.refreshData();\n        gantt.render();\n\n        console.log(gantt._lightbox_template);\n\n        return (\n            <div\n                ref={(input) => { this.ganttContainer = input }}\n                style={{ width: '100%', height: '100%' }}\n            >\n            </div>\n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}